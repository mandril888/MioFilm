angular.module( 'myAngularWeb', [ 'ngRoute', 'controllers', 'config', 'services', 'ngStorage' ] )
angular.module( 'config', [ ] )
	.config( function( $routeProvider ){
			$routeProvider
				.when('/',{
					templateUrl: 'modules/home/home.html',
					controller: 'homeController'
				})
				.when('/home',{
					templateUrl: 'modules/home/home.html',
					controller: 'homeController'
				})
				.when('/specifications/:FILMID',{
					templateUrl: 'modules/specifications/specifications.html',
					controller: 'specificationsController'
				})
				.when('/about',{
					templateUrl: 'modules/about/about.html',
					controller: 'aboutController'
				})
				.otherwise({ redirectTo: '/' }); ;
	})
angular.module( 'controllers', [ 'homeModule', 'specificationsModule', 'aboutModule' ] )
angular.module( 'services', [ 'homeService', 'specificationsService', 'aboutService' ] );
angular.module( 'aboutModule', [ ] )
    .controller( 'aboutController' , function ( $scope ) {
    }) 
angular.module( 'aboutService', [ ] )
    .factory('aboutService', function($http) {
    }) 
angular.module( 'homeModule', [ ] )
	.controller( 'homeController' , function ( $scope, $http, homeService ) {

		$scope.imageNotFoundCover = '../../img/image-not-found-cover.jpg';
		$scope.infoFilmSearched = "";

		$scope.submit = function() {
			$('.list-films').css('display', 'flex')
			$('.insert-text').html('<h1>You have searched: <span class="item-searched">'+ $scope.filmToSearch + '</span></h1>')

			homeService.getInfoFilm( $scope.filmToSearch )
				.then( function ( dataFilmSearched ){
					$scope.infoFilmSearched = dataFilmSearched.data.results;
					console.log($scope.infoFilmSearched);
				})
		}

		$scope.searchFilmByMood = function( mood ) {
			$('.list-films').css('display', 'flex')
			$('.insert-text').html('<h1>You have searched: <span class="item-searched">' + mood + '</span></h1>')

			console.log(mood)
			var randomPage1 = Math.floor(Math.random() * 1000) + 1;
			var randomPage2 = Math.floor(Math.random() * 1000) + 1;
			var moodNumber;

			if ( mood === 'Sad' ) {
				moodNumber = '80|18|10752';
			} else if ( mood === 'Joyful') {
				moodNumber = '12|16|35|10751|14|10402|10749';
			} else if ( mood === 'Mad') {
				moodNumber = '28|80|53|10752';
			} else if ( mood === 'Powerful') {
				moodNumber = '28|12|14|9648|878|53';
			} else if ( mood === 'Scared') {
				moodNumber = '80|27|9648';
			} else if ( mood === 'Peaceful') {
				moodNumber = '99|10751|14|36|10402|10749';
			}

			homeService.getInfoFilmByMood( moodNumber, randomPage1, randomPage2 )
				.then( function ( dataFilmSearched ){
					console.log(dataFilmSearched)
					$scope.infoFilmSearched = dataFilmSearched[0].data.results;
					console.log($scope.infoFilmSearched);
				})
		}

		$('button').on('click', function(event){
			$('html, body').animate({
				scrollTop: $('.to-move-scroll').offset().top
			}, 500);
		});

		$('a').on('click', function(event){
			event.preventDefault();
			$('html, body').animate({
				scrollTop: $('.to-move-scroll').offset().top
			}, 500);
		});

		$('.go-top').on('click', function(event){
			event.preventDefault();
			$('html, body').animate({
				scrollTop: 0 }, 500);
		});

	})
angular.module( 'homeService', [ ] )
	.factory('homeService', function( $http, $q ) {

		var urlToSearchFilm = 'http://api.themoviedb.org/3/search/movie?api_key=71bd8c83c5cc06c197435d2165ac52e4&query=<SEARCH>';
		var urlToSearchFilmByMood1 = 'https://api.themoviedb.org/3/discover/movie?api_key=71bd8c83c5cc06c197435d2165ac52e4&with_genres=<MOOD_NUM>&page=<PAGE1>';
		var urlToSearchFilmByMood2 = 'https://api.themoviedb.org/3/discover/movie?api_key=71bd8c83c5cc06c197435d2165ac52e4&with_genres=<MOOD_NUM>&page=<PAGE2>';

		function getInfoFilm ( filmToSearch ) {
			var urlToSearchFilmChanged = urlToSearchFilm.replace('<SEARCH>', filmToSearch)
			console.log(urlToSearchFilmChanged)
			return $http.get( urlToSearchFilmChanged )
		}

		function getInfoFilmByMood ( moodNumber, randomPage1, randomPage2 ) {

			var mapObj = {
				'<MOOD_NUM>': moodNumber,
				'<PAGE1>': randomPage1,
				'<PAGE2>': randomPage2
			};
			console.log(mapObj)
			var urlToSearchFilmByMoodChanged1 = urlToSearchFilmByMood1.replace(/<MOOD_NUM>|<PAGE1>/gi, function(matched){
				return mapObj[matched];
			});
			var urlToSearchFilmByMoodChanged2 = urlToSearchFilmByMood2.replace(/<MOOD_NUM>|<PAGE2>/gi, function(matched){
				return mapObj[matched];
			});
			console.log(urlToSearchFilmByMoodChanged1)
			console.log(urlToSearchFilmByMoodChanged2)


			var promise1 = $http.get( urlToSearchFilmByMoodChanged1 )
			var promise2 = $http.get( urlToSearchFilmByMoodChanged2 )
			
			return $q.all( [promise1, promise2] )
		}

		return {
			getInfoFilm : getInfoFilm,
			getInfoFilmByMood : getInfoFilmByMood
		}

	})
angular.module( 'specificationsModule', [ ] )
	.controller( 'specificationsController' , function ( $scope, $http, $routeParams, specificationsService ) {

		$scope.imageNotFoundCover = '../../img/image-not-found-cover.jpg';
		$scope.imageNotFoundHeaderCover = '../../img/image-not-found-header-cover.jpg';
		$scope.specificationsFilmSearched = "";
		var filmId = $routeParams.FILMID;

		specificationsService.getSpecificationsFilm( filmId )
			.then( function ( dataFilmSearched ){
				$scope.specificationsFilmSearched = dataFilmSearched.data;
				console.log($scope.specificationsFilmSearched);
			})

	})
angular.module( 'specificationsService', [ ] )
	.factory('specificationsService', function( $http ) {

		var urlToSearchFilm = 'http://api.themoviedb.org/3/movie/<ID_MOVIE>?api_key=71bd8c83c5cc06c197435d2165ac52e4';

		function getSpecificationsFilm ( idFilmToSearch ) {
			var urlToSearchFilmChanged = urlToSearchFilm.replace('<ID_MOVIE>', idFilmToSearch)
			console.log(urlToSearchFilmChanged)
			return $http.get( urlToSearchFilmChanged )
		}

		return {
			getSpecificationsFilm : getSpecificationsFilm
		}

	})